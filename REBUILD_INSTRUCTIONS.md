# –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ Docker —Å –æ—á–∏—Å—Ç–∫–æ–π –ë–î

## üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ –ø–æ—Ä—è–¥–∫—É –≤ PowerShell:

```powershell
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# 2. –£–¥–∞–ª–∏—Ç—å volumes (–ë–î –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞!)
docker volume rm cp_postgres_data

# 3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
docker-compose down --rmi all

# 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω—É–ª—è
docker-compose up -d --build

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤)

```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose down -v
docker-compose up -d --build
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î (–±–µ–∑ rebuild backend)

```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ volume —Å –ë–î
docker volume rm cp_postgres_data

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ (–ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏–∑ sql/*.sql)
docker-compose up -d
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```powershell
   docker-compose logs backend
   docker-compose logs db
   ```

2. **–î–æ–∂–¥–∏—Ç–µ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î** (–≤ –ª–æ–≥–∞—Ö db –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏):
   ```
   /docker-entrypoint-initdb.d/01_schema.sql
   /docker-entrypoint-initdb.d/02_triggers.sql
   /docker-entrypoint-initdb.d/03_functions.sql
   /docker-entrypoint-initdb.d/04_views.sql
   /docker-entrypoint-initdb.d/05_indexes.sql
   /docker-entrypoint-initdb.d/06_generate_data.sql
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API:**
   ```powershell
   # –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   start http://localhost:8000/docs
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Swagger: http://localhost:8000/docs
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ `GET /users/` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ `GET /contests/` - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è

---

## üß™ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö endpoints:

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ requests, –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
pip install requests

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
python test_api.py
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—Ç:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (users, contests, problems, submissions)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 409 Conflict, –∞ –Ω–µ 500)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö FK (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 400 Bad Request, –∞ –Ω–µ 500)
- ‚úÖ Batch import —Å —á–∞—Å—Ç–∏—á–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
- ‚úÖ Analytics endpoints
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ

---

## üìù –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Swagger

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/docs –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç—ã:

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥—É–±–ª–∏–∫–∞—Ç–æ–º username

1. `POST /users/` - —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ```json
   {
     "username": "duplicate_test",
     "email": "test@example.com",
     "full_name": "Test User",
     "password_hash": "hash",
     "role": "participant"
   }
   ```
   **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 201 Created

2. `POST /users/` - –ø–æ–ø—ã—Ç–∞–π—Ç–µ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â–µ —Ä–∞–∑  
   **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 409 Conflict (–ù–ï 500!)

### –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º created_by

`POST /contests/`:
```json
{
  "title": "Test Contest",
  "description": "Test",
  "contest_type": "Codeforces",
  "status": "upcoming",
  "start_time": "2025-12-25T10:00:00",
  "duration_minutes": 120,
  "created_by": 999999
}
```
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 400 Bad Request —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–æ FK (–ù–ï 500!)

### –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—ã–ª–∫–∏ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ FK

`POST /submissions/`:
```json
{
  "user_id": 999999,
  "contest_id": 1,
  "problem_id": 1,
  "language": "Python",
  "source_code": "print('test')",
  "verdict": "Pending",
  "execution_time_ms": 0,
  "memory_used_kb": 0
}
```
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 400 Bad Request (–ù–ï 500!)

### –¢–µ—Å—Ç 4: Batch import —Å –æ—à–∏–±–∫–∞–º–∏

`POST /batch/import`:
```json
{
  "entity_type": "users",
  "data": [
    {
      "username": "valid_user",
      "email": "valid@example.com",
      "full_name": "Valid User",
      "password_hash": "hash",
      "role": "participant"
    },
    {
      "username": "invalid_user",
      "email": "INVALID_EMAIL",
      "full_name": "Invalid User",
      "password_hash": "hash",
      "role": "participant"
    }
  ]
}
```
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 200/207 —Å `success_count: 1` –∏ `errors: [...]` (–ù–ï 500!)

### –¢–µ—Å—Ç 5: Analytics endpoints

- `GET /analytics/top-participants` - –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–ø —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `GET /analytics/verdict-stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–µ—Ä–¥–∏–∫—Ç–∞–º
- `GET /analytics/user-activity` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GET /analytics/problem-difficulty` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 200 OK –¥–ª—è –≤—Å–µ—Ö

---

## üêõ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
‚ùå –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞ ‚Üí **500 Internal Server Error**  
‚ùå –ü—Ä–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º FK ‚Üí **500 Internal Server Error**  
‚ùå –ü—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ constraint ‚Üí **500 Internal Server Error**

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞ ‚Üí **409 Conflict** —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º  
‚úÖ –ü—Ä–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º FK ‚Üí **400 Bad Request** —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã  
‚úÖ –ü—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ constraint ‚Üí **400 Bad Request** —Å –¥–µ—Ç–∞–ª—è–º–∏  
‚úÖ Batch operations –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

–§–∞–π–ª `test_api.py` –≤–∫–ª—é—á–∞–µ—Ç:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–µ—Å—Ç—ã |
|-----------|-------|
| **Users** | –°–æ–∑–¥–∞–Ω–∏–µ, –¥—É–±–ª–∏–∫–∞—Ç—ã username/email, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ |
| **Contests** | –°–æ–∑–¥–∞–Ω–∏–µ, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π created_by, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ |
| **Problems** | –°–æ–∑–¥–∞–Ω–∏–µ, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π author_id, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ |
| **Submissions** | –°–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–¥–∏–∫—Ç–∞, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ FK |
| **Batch** | –ò–º–ø–æ—Ä—Ç —Å —á–∞—Å—Ç–∏—á–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **Analytics** | –í—Å–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints |

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î —á–µ—Ä–µ–∑ pgAdmin4

–ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–ª–∏ pgAdmin4 –≤ docker-compose.yml:

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5050
2. –õ–æ–≥–∏–Ω: `admin@admin.com`, –ø–∞—Ä–æ–ª—å: `admin`
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î:
   - Host: `db`
   - Port: `5432`
   - Database: `cpdb`
   - Username: `cpuser`
   - Password: `cppassword`

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ `06_generate_data.sql`.

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è volume –ë–î —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –∏–∑ SQL-—Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ `sql/`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `sql/` —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (01-06, –ë–ï–ó test_data)
- –§–∞–π–ª—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `sql/06_generate_data.sql`
